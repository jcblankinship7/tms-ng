<div class="min-h-screen">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-2xl font-bold text-gray-800">{{ displayTitle() }}</h2>
      @if (persona()) {
        <p class="text-sm text-gray-500 mt-1">Persona: {{ persona() }}</p>
      }
    </div>

    @if (persona() === 'Customer') {
      <button
        type="button"
        (click)="createNewQuote()"
        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2">
        <span>+</span>
        Get New Quote
      </button>
    }
  </div>

  <!-- Customer Selector (for multi-customer personas) -->
  @if (showCustomerSelector()) {
    <div class="mb-6 bg-white p-5 rounded-lg shadow-md" style="border: 1px solid #D0D0CE;">
      <label class="block text-xs font-bold uppercase tracking-wider mb-3" style="color: #53565A;">Select Customer</label>
      <select
        title="Select Customer"
        [value]="selectedCustomerId() || ''"
        (change)="onCustomerChanged($any($event).target.value)"
        class="w-full max-w-sm px-4 py-3 border-2 rounded font-semibold transition-all"
        style="border-color: #D0D0CE; color: #002855;"
        onfocus="this.style.borderColor='#003DA5'"
        onblur="this.style.borderColor='#D0D0CE'">
        <option value="">All Customers</option>
        <option value="CUST-001">Customer 001</option>
        <option value="CUST-002">Customer 002</option>
        <option value="CUST-003">Customer 003</option>
      </select>
    </div>
  }

  <!-- Loading State -->
  @if (loading()) {
    <div class="text-center py-12 text-gray-500">Loading...</div>
  } @else {

    <!-- ORDERS VIEW (for non-ServiceProvider personas) -->
    @if (!isMovesView()) {

    <!-- Empty State -->
    @if (orders().length === 0) {
      <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-gray-500 mb-4">No orders found</p>
        @if (persona() === 'Customer') {
          <button
            (click)="createNewQuote()"
            class="text-blue-600 hover:text-blue-800 font-medium">
            Create your first quote
          </button>
        }
      </div>
    } @else {

      <!-- Orders Table -->
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="w-full">
          <thead class="bg-gray-100 border-b">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Order ID</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Date</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Status</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Moves</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Price</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Actions</th>
            </tr>
          </thead>

          <tbody class="divide-y">
            @for (order of orders(); track order.id) {
              <tr
                class="hover:bg-gray-50 cursor-pointer"
                (click)="viewOrder(order.id)">
                
                <td class="px-6 py-4 text-sm font-medium text-gray-900">
                  {{ order.id }}
                </td>

                <td class="px-6 py-4 text-sm text-gray-600">
                  {{ order.createdDate }}
                </td>

                <td class="px-6 py-4">
                  <span
                    [class]="order.status === 'Active'
                      ? 'bg-green-100 text-green-800'
                      : 'bg-gray-100 text-gray-800'"
                    class="px-2 py-1 text-xs rounded-full">
                    {{ order.status }}
                  </span>
                </td>

                <td class="px-6 py-4 text-sm text-gray-600">
                  {{ order.moves.length }}
                </td>

                <td class="px-6 py-4 text-sm font-semibold text-gray-900">
                  ${{ order.totalPrice.toFixed(2) }}
                </td>

                <td class="px-6 py-4">
                  <button
                    type="button"
                    (click)="viewOrder(order.id); $event.stopPropagation()"
                    class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                    View Details
                  </button>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="6" class="text-center py-12 text-gray-500">
                  No orders found.
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

    }

    } @else {

    <!-- MOVES VIEW (for ServiceProvider) -->

    <!-- Empty State -->
    @if (moves().length === 0) {
      <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-gray-500">No moves assigned to you</p>
      </div>
    } @else {

      <!-- Moves Table -->
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="w-full">
          <thead class="bg-gray-100 border-b">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Move ID</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Order #</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Move #</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Origin</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Destination</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Container Seal</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Type</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Actions</th>
            </tr>
          </thead>

          <tbody class="divide-y">
            @for (move of moves(); track move.id) {
              <tr
                class="hover:bg-gray-50 cursor-pointer"
                (click)="viewMove(move.id)">
                
                <td class="px-6 py-4 text-sm font-medium text-gray-900">
                  {{ move.id }}
                </td>

                <td class="px-6 py-4 text-sm font-medium text-blue-600">
                  {{ move.orderNumber }}
                </td>

                <td class="px-6 py-4 text-sm font-medium text-gray-900">
                  {{ move.moveOrder }}
                </td>

                <td class="px-6 py-4 text-sm text-gray-600">
                  <div class="font-medium">{{ move.origin.address }}</div>
                  @if (move.originDepartureTime) {
                    <div class="text-xs text-gray-500">Departed: {{ move.originDepartureTime | slice:0:10 }}</div>
                  }
                </td>

                <td class="px-6 py-4 text-sm text-gray-600">
                  <div class="font-medium">{{ move.destination.address }}</div>
                  @if (move.destinationArrivalTime) {
                    <div class="text-xs text-gray-500">Arrival: {{ move.destinationArrivalTime | slice:0:10 }}</div>
                  }
                </td>

                <td class="px-6 py-4 text-sm font-mono text-gray-900">
                  {{ move.shipmentDetails?.containerSealNumber || 'N/A' }}
                </td>

                <td class="px-6 py-4">
                  <span
                    class="px-2 py-1 text-xs rounded-full font-medium"
                    style="background-color: #E5F0FF; color: #003DA5;">
                    {{ move.moveType }}
                  </span>
                </td>

                <td class="px-6 py-4">
                  <button
                    type="button"
                    (click)="viewMove(move.id); $event.stopPropagation()"
                    class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                    View Details
                  </button>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="8" class="text-center py-12 text-gray-500">
                  No moves found.
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

    }

    }

  }
